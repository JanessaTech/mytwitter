# My distributed twitter
Build a distirbuted twitter using go and ethereum blockchain

# How to run codes
 - Install ganache and truffle 
 - Start ganache
 - Deploy smart contracts
 - Generate go-binding for all smart contracts(Optional)
 - Start Web server
 - Send Restful requests

# Install ganache and truffle 
  Visit the official weibsite to check how to install ganache and truffle: https://trufflesuite.com/docs/truffle/
# Start ganache

  Using ganache UI to start ganache.

  In the new workspace, give the following settings:
  - In WORKSPACE tab, set WORKSPACE NAME: twitter
  - In WORKSPACE tab, set TRUFFLE PROJECTS: Add contract/truffle-config.js by clicking [ADD PROJECT] button
  - In SERVER tab, set PORT NUMBER as 8575
  - In ACCOUNT & KEY tab, set Mnemonic to be "cake attract curve erase army talent parade patrol dumb cruel hotel sauce"

  Leave the rest of settings as default values

# Deploy smart contracts
Enter the contract folder, run the following commands on the console:
1. Compile contracts
```
 truffle compile
```
![Alt text](images/compile-contracts.png "compile contracts in truffle")
2. Deploy contract
```
truffle migrate
```
![Alt text](images/deploy-contracts.png "deploy contracts in truffle")

# Generate go-binding for all smart contracts(Optional)
 Run the following commands to generate go-binding files for contracts
- Build abigen tool
Download ethereum source code and build like below
```
cd go-ethereum
go build ./cmd/abigen
```
- Generate go-binding files: TwitterUser.go for TwitterUser.sol and Twitter.go for Twitter.sol
Enter contract/contracts folder, run the following commands:
```
solcjs --abi TwitterUser.sol -o build
solcjs --bin TwitterUser.sol -o build
abigen --abi ./build/TwitterUser_sol_TwitterUser.abi --pkg twitterapi --type TwitterUser --out TwitterUser.go --bin ./build/TwitterUser_sol_TwitterUser.bin

solcjs --abi Twitter.sol -o build
solcjs --bin Twitter.sol -o build
abigen --abi ./build/Twitter_sol_Twitter.abi --pkg twitterapi --type Twitter --out Twitter.go --bin ./build/Twitter_sol_Twitter.bin
```
Copy Twitter.go and TwitterUser.go to twitterApi folder(You don't need to copy them, because I've put the copies under twitterApi folder)
# Start Web server
## Modify config file before starting the web server
Open config/properties.json
Edit 3 items: accounts, twitterUserAddr and twitterAddr
- accounts
 For the first item in accounts, key is the key of the first account generated by ganache, address is the address of that first account.
 The second item in accounts is for the second account.
 The third item in accounts is for the third account.
 (For simplicity, don't change name for all these 3 items above)
 
![Alt text](images/config-key-address.png "deploy contracts in truffle")

- twitterUserAddr
  Set the value to be the address of the contract TwitterUser, which is 0xCfe30d5B4774048c1Dd231714B0Ac33960cd955f in this case (In your env, the address of TwitterUser is different from here)
- twitterAddr
  Set the value to be the address of the contract Twitter, which is 0x899299896C52797623201347Cfd4a99B6297e200 in this case (In your env, the address of TwitterUser is different from here)
## Download dependences
```
go get github.com/ethereum/go-ethereum
go get github.com/ethereum/go-ethereum/accounts/abi/bind 
go get github.com/knadh/koanf
go get github.com/gin-gonic/gin
go get go.uber.org/fx
go get github.com/spf13/cobra
```
## Start web server
Run one of the three commands below to start a web server:
```
.\go-microservice-template.exe
.\go-microservice-template.exe server -c "./config/properties.json"
.\go-microservice-template.exe -c "./config/properties.json"
```
# Send Restful requests (user cases)
## Register users
In postman, send 2 requests with http://127.0.0.1:8080/api/admin/users (POST)
For the first request, request body in the form of json is below:
```
{
    "name" : "user1",
    "password" : "123456"
}
```
The response returned contains the transaction hash code of this request:
```
{
    "code": 200,
    "message": "success",
    "details": {
        "tx": "0x365c5c91a030239161df716e395025ee68ce0de522f4f4dd66ac177e4769fd1b"
    }
}
```


For the second request, request body in the form of json is below:
```
{
    "name" : "user1",
    "password" : "78910"
}
```
The response returned contains the transaction hash code of this request:
```
{
    "code": 200,
    "message": "success",
    "details": {
        "tx": "0xeb0cde103269be03b9bd6ed94792af72a303588ab5db95819d52d4b87c73f529"
    }
}
```
## Check registered user info

## Login
## Check the number of registered users
## Post message by one logined user
## Check the number of posts by that logined user
## Read the content of one post posted by that logined user
## Log
xxx

